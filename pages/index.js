import Head from "next/head"
import ImageGrid from "../components/ImageGrid"
import Hero from "../components/Hero"
import { collection, getDocs, query, orderBy } from "firebase/firestore"
import { db } from "../public/firebase/firebase"
import BackToTop from "../components/BackToTop"

export default function Home({ imgList, blogList }) {
	return (
		<div>
			<Head>
				<title>Create Next App</title>
				<meta
					name="description"
					content="Generated by create next app"
				/>
				<link rel="icon" href="/favicon.ico" />
			</Head>
			<BackToTop></BackToTop>

			<Hero></Hero>
			<ImageGrid imgList={imgList} blogList={blogList}></ImageGrid>
		</div>
	)
}

export const getServerSideProps = async (context) => {
	let paintingsList = []
	let projectsList = []
	try {
		const imageQuery = query(collection(db, "slike"), orderBy("date"))
		const blogQuery = query(collection(db, "blog"), orderBy("date"))
		const imageQuerySnapshot = await getDocs(imageQuery)
		imageQuerySnapshot.forEach((doc) => {
			paintingsList.push({ id: doc.id, ...doc.data() })
		})
		const blogQuerySnapshot = await getDocs(blogQuery)
		blogQuerySnapshot.forEach((doc) => {
			projectsList.push({ id: doc.id, ...doc.data() })
		})
		return {
			props: { imgList: paintingsList, blogList: projectsList },
		}
	} catch (err) {
		console.log(err)
		return { props: {} }
	}
}
